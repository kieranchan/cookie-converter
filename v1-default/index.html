<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie Ê†ºÂºèËΩ¨Êç¢Âô®</title>
    <link rel="manifest" href="../manifest.json">
    <style>
        :root {
            --bg: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #475569;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        [data-theme="light"] {
            --bg: #f1f5f9;
            --bg-card: #ffffff;
            --bg-input: #f8fafc;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 16px;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .icon-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .icon-btn:hover {
            background: var(--bg-input);
            color: var(--text);
        }

        /* Main Layout */
        .main {
            flex: 1;
            display: flex;
            gap: 1px;
            background: var(--border);
            overflow: hidden;
        }

        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-card);
            min-width: 0;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            gap: 12px;
            flex-wrap: wrap;
        }

        .panel-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .panel-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Input Panel */
        .input-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .input-area textarea {
            flex: 1;
            padding: 16px;
            border: none;
            background: var(--bg-input);
            color: var(--text);
            font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.6;
            resize: none;
        }

        .input-area textarea:focus {
            outline: none;
        }

        .input-area textarea::placeholder {
            color: var(--text-muted);
        }

        .input-toolbar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-input);
            color: var(--text);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover { background: var(--border); }

        .btn-primary {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .btn-primary:hover { background: var(--accent-hover); }

        .btn-success {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Segments */
        .segment {
            display: inline-flex;
            border: 1px solid var(--border);
            border-radius: 6px;
            overflow: hidden;
        }

        .segment-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .segment-btn:not(:last-child) {
            border-right: 1px solid var(--border);
        }

        .segment-btn:hover { background: var(--bg-input); }

        .segment-btn.active {
            background: var(--accent);
            color: white;
        }

        .icon-btn:focus-visible,
        .btn:focus-visible,
        .segment-btn:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        /* Output Panel */
        .output-stats {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .output-stats strong { color: var(--text); }

        .output-toolbar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            max-width: 240px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 6px 10px 6px 32px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-input);
            color: var(--text);
            font-size: 13px;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .search-box svg {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .output-content {
            flex: 1;
            overflow: auto;
            padding: 16px;
        }

        /* String View */
        .string-output {
            background: var(--bg-input);
            border-radius: 8px;
            padding: 16px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.6;
            word-break: break-all;
            white-space: pre-wrap;
        }

        .export-btns {
            display: flex;
            gap: 8px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        /* Table View */
        .cookie-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .cookie-table th,
        .cookie-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .cookie-table th {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            background: var(--bg-card);
        }

        .cookie-table tbody tr:hover {
            background: var(--bg-input);
        }

        .cookie-name {
            font-family: monospace;
            color: var(--accent);
            font-weight: 500;
        }

        .cookie-value {
            font-family: monospace;
            color: var(--text-muted);
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            margin-right: 4px;
        }

        .badge-secure { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .badge-httponly { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        .badge-samesite { background: rgba(168, 85, 247, 0.2); color: #c084fc; }
        .badge-expired { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .badge-session { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .badge-sensitive { background: rgba(239, 68, 68, 0.2); color: #f87171; }

        [data-theme="light"] .badge-secure { background: #dcfce7; color: #16a34a; }
        [data-theme="light"] .badge-httponly { background: #dbeafe; color: #2563eb; }
        [data-theme="light"] .badge-samesite { background: #f3e8ff; color: #9333ea; }
        [data-theme="light"] .badge-expired { background: #fee2e2; color: #dc2626; }
        [data-theme="light"] .badge-session { background: #fef3c7; color: #d97706; }
        [data-theme="light"] .badge-sensitive { background: #fee2e2; color: #dc2626; }

        /* Domain View */
        .domain-group {
            margin-bottom: 20px;
        }

        .domain-header {
            font-weight: 600;
            font-size: 13px;
            padding: 8px 12px;
            background: var(--bg-input);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .domain-list {
            padding-left: 12px;
        }

        .domain-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            border-left: 2px solid var(--border);
            font-size: 13px;
        }

        .domain-item:hover {
            background: var(--bg-input);
            border-left-color: var(--accent);
        }

        /* Warning */
        .warning-box {
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            font-size: 13px;
            color: #fbbf24;
        }

        [data-theme="light"] .warning-box {
            background: #fef3c7;
            color: #92400e;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-muted);
            text-align: center;
            padding: 40px;
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* History Panel */
        .history-panel {
            position: fixed;
            top: 0;
            right: -320px;
            width: 320px;
            height: 100vh;
            background: var(--bg-card);
            border-left: 1px solid var(--border);
            transition: right 0.2s;
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        .history-panel.open { right: 0; }

        .history-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .history-item {
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 4px;
        }

        .history-item:hover { background: var(--bg-input); }

        .history-time {
            font-size: 11px;
            color: var(--text-muted);
        }

        .history-preview {
            font-size: 12px;
            margin-top: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: var(--text);
        }

        /* Overlay */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show { display: block; }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text);
            color: var(--bg);
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 13px;
            opacity: 0;
            transition: all 0.2s;
            z-index: 1001;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Checkbox */
        .checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-muted);
            cursor: pointer;
        }

        .checkbox input { width: 14px; height: 14px; }

        /* Responsive */
        @media (max-width: 768px) {
            .main {
                flex-direction: column;
            }
            .panel {
                min-height: 45vh;
            }
        }

        /* Drop zone effect */
        .drop-active {
            background: rgba(59, 130, 246, 0.1) !important;
        }

        .view-content { display: none; }
        .view-content.active { display: block; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <span>üç™</span>
            <span>Cookie ËΩ¨Êç¢Âô®</span>
        </div>
        <div class="header-actions">
            <button class="icon-btn" onclick="toggleHistory()" title="ÂéÜÂè≤ËÆ∞ÂΩï">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
                </svg>
            </button>
            <button class="icon-btn" onclick="toggleTheme()" title="ÂàáÊç¢‰∏ªÈ¢ò">
                <svg id="themeIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                </svg>
            </button>
        </div>
    </header>

    <main class="main">
        <!-- Input Panel -->
        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">ËæìÂÖ•</span>
                <div class="segment">
                    <button class="segment-btn active" data-format="auto">Ëá™Âä®</button>
                    <button class="segment-btn" data-format="table">Ë°®Ê†º</button>
                    <button class="segment-btn" data-format="json">JSON</button>
                    <button class="segment-btn" data-format="netscape">Netscape</button>
                </div>
            </div>
            <div class="panel-body">
                <div class="input-area" id="dropZone">
                    <textarea id="input" placeholder="Á≤òË¥¥ Cookie Êï∞ÊçÆÔºåÊàñÊãñÊãΩÊñá‰ª∂Âà∞Ê≠§Â§Ñ...

ÊîØÊåÅÊ†ºÂºè:
‚Ä¢ ÊµèËßàÂô® DevTools Ë°®Ê†º
‚Ä¢ JSON Êï∞ÁªÑ
‚Ä¢ Netscape cookies.txt"></textarea>
                </div>
                <div class="input-toolbar">
                    <button class="btn btn-primary" onclick="convert()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                        ËΩ¨Êç¢
                    </button>
                    <button class="btn" onclick="clearAll()">Ê∏ÖÁ©∫</button>
                    <button class="btn" onclick="loadExample()">Á§∫‰æã</button>
                    <label class="checkbox">
                        <input type="checkbox" id="urlDecode" checked>
                        URL Ëß£Á†Å
                    </label>
                </div>
            </div>
        </div>

        <!-- Output Panel -->
        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">ËæìÂá∫</span>
                <div class="output-stats" id="stats" style="display:none">
                    <span><strong id="cookieCount">0</strong> Cookies</span>
                    <span><strong id="domainCount">0</strong> ÂüüÂêç</span>
                </div>
            </div>
            <div class="panel-body">
                <div class="output-toolbar" id="toolbar" style="display:none">
                    <div class="search-box">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
                        </svg>
                        <input type="text" id="searchInput" placeholder="ÊêúÁ¥¢..." oninput="filterCookies()">
                    </div>
                    <div class="segment">
                        <button class="segment-btn active" data-view="string">Â≠óÁ¨¶‰∏≤</button>
                        <button class="segment-btn" data-view="table">Ë°®Ê†º</button>
                        <button class="segment-btn" data-view="domain">ÂüüÂêç</button>
                    </div>
                </div>

                <div class="output-content">
                    <div id="emptyState" class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2"/>
                            <rect x="9" y="3" width="6" height="4" rx="1"/>
                        </svg>
                        <div>Âú®Â∑¶‰æßÁ≤òË¥¥ Cookie Êï∞ÊçÆ</div>
                        <div style="font-size:12px;margin-top:4px">ÊîØÊåÅÊãñÊãΩÊñá‰ª∂ ¬∑ Ctrl+Enter ËΩ¨Êç¢</div>
                    </div>

                    <div id="outputArea" style="display:none">
                        <div id="warningBox" class="warning-box" style="display:none"></div>

                        <div id="viewString" class="view-content active">
                            <div class="string-output" id="stringOutput"></div>
                            <div class="export-btns">
                                <button class="btn btn-success btn-sm" onclick="copyString()">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/>
                                    </svg>
                                    Â§çÂà∂
                                </button>
                                <button class="btn btn-sm" onclick="exportAs('json')">JSON</button>
                                <button class="btn btn-sm" onclick="exportAs('netscape')">Netscape</button>
                                <button class="btn btn-sm" onclick="exportAs('curl')">curl</button>
                            </div>
                        </div>

                        <div id="viewTable" class="view-content">
                            <table class="cookie-table">
                                <thead>
                                    <tr>
                                        <th>ÂêçÁß∞</th>
                                        <th>ÂÄº</th>
                                        <th>ÂüüÂêç</th>
                                        <th>Â±ûÊÄß</th>
                                    </tr>
                                </thead>
                                <tbody id="tableBody"></tbody>
                            </table>
                        </div>

                        <div id="viewDomain" class="view-content">
                            <div id="domainGroups"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- History Panel -->
    <div class="overlay" id="overlay" onclick="toggleHistory()"></div>
    <div class="history-panel" id="historyPanel">
        <div class="history-header">
            <span style="font-weight:600">ÂéÜÂè≤ËÆ∞ÂΩï</span>
            <button class="icon-btn" onclick="clearHistory()" title="Ê∏ÖÁ©∫">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z"/>
                </svg>
            </button>
        </div>
        <div class="history-list" id="historyList"></div>
    </div>

    <div class="toast" id="toast" aria-live="polite"></div>

    <script>
        let parsedCookies = [];
        let currentFormat = 'auto';
        const SENSITIVE = ['session', 'token', 'auth', 'key', 'secret', 'password', 'jwt'];

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initDragDrop();
            initSegments();
            initKeyboard();
            renderHistory();
        });

        // Theme
        function initTheme() {
            const t = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', t);
            updateThemeIcon(t);
        }

        function toggleTheme() {
            const c = document.documentElement.getAttribute('data-theme');
            const n = c === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', n);
            localStorage.setItem('theme', n);
            updateThemeIcon(n);
        }

        function updateThemeIcon(t) {
            document.getElementById('themeIcon').innerHTML = t === 'dark'
                ? '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>'
                : '<circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>';
        }

        // Drag & Drop
        function initDragDrop() {
            const z = document.getElementById('dropZone');
            ['dragenter', 'dragover'].forEach(e => z.addEventListener(e, ev => { ev.preventDefault(); z.classList.add('drop-active'); }));
            ['dragleave', 'drop'].forEach(e => z.addEventListener(e, () => z.classList.remove('drop-active')));
            z.addEventListener('drop', e => {
                e.preventDefault();
                const f = e.dataTransfer.files[0];
                if (f) {
                    const r = new FileReader();
                    r.onload = ev => { document.getElementById('input').value = ev.target.result; convert(); };
                    r.readAsText(f);
                }
            });
        }

        // Segments
        function initSegments() {
            // Format
            document.querySelectorAll('[data-format]').forEach(b => {
                b.addEventListener('click', () => {
                    document.querySelectorAll('[data-format]').forEach(x => x.classList.remove('active'));
                    b.classList.add('active');
                    currentFormat = b.dataset.format;
                });
            });
            // View
            document.querySelectorAll('[data-view]').forEach(b => {
                b.addEventListener('click', () => {
                    document.querySelectorAll('[data-view]').forEach(x => x.classList.remove('active'));
                    b.classList.add('active');
                    document.querySelectorAll('.view-content').forEach(v => v.classList.remove('active'));
                    document.getElementById('view' + capitalize(b.dataset.view)).classList.add('active');
                });
            });
        }

        function initKeyboard() {
            document.getElementById('input').addEventListener('keydown', e => {
                if (e.ctrlKey && e.key === 'Enter') convert();
            });
        }

        // Parse
        function detectFormat(t) {
            t = t.trim();
            if (t.startsWith('[') || t.startsWith('{')) return 'json';
            if (t.includes('# Netscape') || /^(TRUE|FALSE)\t/.test(t.split('\n')[0])) return 'netscape';
            return 'table';
        }

        function parseTable(t) {
            const H = new Set(['name','value','domain','path','expires','size','httponly','secure','samesite','ÂêçÁß∞','ÂÄº','ÂüüÂêç']);
            const cookies = [], seen = new Map();
            for (const line of t.split('\n')) {
                const tr = line.trim();
                if (!tr || tr.startsWith('#')) continue;
                const p = tr.includes('\t') ? tr.split('\t') : tr.split(/  +/);
                if (p.length < 2 || H.has(p[0].trim().toLowerCase())) continue;
                const name = p[0].trim(), value = p[1].trim();
                if (!/^[a-zA-Z0-9!#$%&'*+\-.^_`|~]+$/.test(name)) continue;
                const c = { name, value, domain: p[2]?.trim()||'', path: p[3]?.trim()||'/', expires: p[4]?.trim()||'', httpOnly: p[6]?.includes('‚úì'), secure: p[7]?.includes('‚úì'), sameSite: p[8]?.trim()||'' };
                seen.has(name) ? cookies[seen.get(name)] = c : (seen.set(name, cookies.length), cookies.push(c));
            }
            return cookies;
        }

        function parseJSON(t) {
            let d = JSON.parse(t);
            if (!Array.isArray(d)) d = [d];
            return d.map(c => ({ name: c.name||'', value: c.value||'', domain: c.domain||'', path: c.path||'/', expires: c.expirationDate ? new Date(c.expirationDate*1000).toISOString() : (c.expires||''), httpOnly: c.httpOnly||false, secure: c.secure||false, sameSite: c.sameSite||'' })).filter(c => c.name);
        }

        function parseNetscape(t) {
            const cookies = [];
            for (const line of t.split('\n')) {
                const tr = line.trim();
                if (!tr || tr.startsWith('#')) continue;
                const p = tr.split('\t');
                if (p.length < 7) continue;
                cookies.push({ name: p[5], value: p[6], domain: p[0], path: p[2], expires: p[4]!=='0' ? new Date(parseInt(p[4])*1000).toISOString() : 'Session', httpOnly: p[1]==='TRUE', secure: p[3]==='TRUE', sameSite: '' });
            }
            return cookies;
        }

        function parse(t, f) {
            if (f === 'auto') f = detectFormat(t);
            if (f === 'json') return parseJSON(t);
            if (f === 'netscape') return parseNetscape(t);
            return parseTable(t);
        }

        // Convert
        function convert() {
            const input = document.getElementById('input').value;
            if (!input.trim()) { toast('ËØ∑ËæìÂÖ•Êï∞ÊçÆ'); return; }
            try {
                parsedCookies = parse(input, currentFormat);
                if (!parsedCookies.length) { toast('Êú™Ëß£ÊûêÂá∫ÊúâÊïà Cookie'); return; }
                document.getElementById('emptyState').style.display = 'none';
                document.getElementById('outputArea').style.display = 'block';
                document.getElementById('stats').style.display = 'flex';
                document.getElementById('toolbar').style.display = 'flex';
                render();
                saveHistory(input, parsedCookies.length);
            } catch (e) { toast('Ëß£ÊûêÂ§±Ë¥•: ' + e.message); }
        }

        // Render
        function render() {
            const decode = document.getElementById('urlDecode').checked;
            const search = document.getElementById('searchInput').value.toLowerCase();
            const filtered = parsedCookies.filter(c => c.name.toLowerCase().includes(search) || c.value.toLowerCase().includes(search) || c.domain.toLowerCase().includes(search));

            const domains = new Set(filtered.map(c => c.domain));
            document.getElementById('cookieCount').textContent = filtered.length;
            document.getElementById('domainCount').textContent = domains.size;

            // Warning
            const sens = filtered.filter(c => SENSITIVE.some(k => c.name.toLowerCase().includes(k)));
            const wb = document.getElementById('warningBox');
            if (sens.length) {
                wb.innerHTML = `<strong>‚ö† ÂÆâÂÖ®ÊèêÁ§∫:</strong> Ê£ÄÊµãÂà∞ ${sens.length} ‰∏™ÊïèÊÑü Cookie (${sens.map(c=>c.name).join(', ')})`;
                wb.style.display = 'block';
            } else wb.style.display = 'none';

            // String
            document.getElementById('stringOutput').textContent = filtered.map(c => `${c.name}=${c.value}`).join('; ');

            // Table
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = filtered.map(c => {
                const v = decode ? tryDecode(c.value) : c.value;
                const isSens = SENSITIVE.some(k => c.name.toLowerCase().includes(k));
                const expired = c.expires && c.expires !== 'Session' && new Date(c.expires) < new Date();
                return `<tr>
                    <td class="cookie-name">${esc(c.name)}${isSens ? ' <span class="badge badge-sensitive">ÊïèÊÑü</span>' : ''}</td>
                    <td class="cookie-value" title="${esc(c.value)}">${esc(v)}</td>
                    <td>${esc(c.domain)}</td>
                    <td>
                        ${c.secure ? '<span class="badge badge-secure">Secure</span>' : ''}
                        ${c.httpOnly ? '<span class="badge badge-httponly">HttpOnly</span>' : ''}
                        ${c.sameSite ? '<span class="badge badge-samesite">'+c.sameSite+'</span>' : ''}
                        ${expired ? '<span class="badge badge-expired">ËøáÊúü</span>' : ''}
                        ${!c.expires || c.expires==='Session' ? '<span class="badge badge-session">Session</span>' : ''}
                    </td>
                </tr>`;
            }).join('');

            // Domain
            const groups = {};
            filtered.forEach(c => { const d = c.domain || '(Êú™Áü•)'; (groups[d] = groups[d] || []).push(c); });
            document.getElementById('domainGroups').innerHTML = Object.keys(groups).sort().map(d => `
                <div class="domain-group">
                    <div class="domain-header">${esc(d)} (${groups[d].length})</div>
                    <div class="domain-list">
                        ${groups[d].map(c => `<div class="domain-item"><span class="cookie-name">${esc(c.name)}</span><span class="cookie-value">${esc(decode ? tryDecode(c.value) : c.value)}</span></div>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function filterCookies() { render(); }

        // Export
        function copyString() {
            navigator.clipboard.writeText(document.getElementById('stringOutput').textContent)
                .then(() => toast('Â∑≤Â§çÂà∂'))
                .catch(() => toast('Â§çÂà∂Â§±Ë¥•'));
        }

        function exportAs(f) {
            let content, name, type;
            if (f === 'json') { content = JSON.stringify(parsedCookies, null, 2); name = 'cookies.json'; type = 'application/json'; }
            else if (f === 'netscape') {
                content = '# Netscape HTTP Cookie File\n' + parsedCookies.map(c => {
                    const exp = c.expires && c.expires !== 'Session' ? Math.floor(new Date(c.expires).getTime()/1000) : 0;
                    return `${c.domain}\tTRUE\t${c.path}\t${c.secure?'TRUE':'FALSE'}\t${exp}\t${c.name}\t${c.value}`;
                }).join('\n');
                name = 'cookies.txt'; type = 'text/plain';
            } else {
                content = `curl -H "Cookie: ${parsedCookies.map(c=>`${c.name}=${c.value}`).join('; ')}" [URL]`;
                name = 'curl.txt'; type = 'text/plain';
            }
            const a = document.createElement('a');
            const url = URL.createObjectURL(new Blob([content], {type}));
            a.href = url;
            a.download = name;
            a.click();
            setTimeout(() => URL.revokeObjectURL(url), 0);
            toast('Â∑≤ÂØºÂá∫ ' + f.toUpperCase());
        }

        // History
        function saveHistory(input, count) {
            const h = JSON.parse(localStorage.getItem('history') || '[]');
            h.unshift({ time: Date.now(), preview: input.slice(0, 80), count, data: input });
            localStorage.setItem('history', JSON.stringify(h.slice(0, 20)));
            renderHistory();
        }

        function renderHistory() {
            const h = JSON.parse(localStorage.getItem('history') || '[]');
            document.getElementById('historyList').innerHTML = h.length ? h.map((it, i) => `
                <div class="history-item" onclick="loadHistory(${i})">
                    <div class="history-time">${new Date(it.time).toLocaleString()} ¬∑ ${it.count} cookies</div>
                    <div class="history-preview">${esc(it.preview)}</div>
                </div>
            `).join('') : '<div style="text-align:center;padding:40px;color:var(--text-muted)">ÊöÇÊó†ËÆ∞ÂΩï</div>';
        }

        function loadHistory(i) {
            const h = JSON.parse(localStorage.getItem('history') || '[]');
            if (h[i]) { document.getElementById('input').value = h[i].data; toggleHistory(); convert(); }
        }

        function clearHistory() { localStorage.removeItem('history'); renderHistory(); toast('Â∑≤Ê∏ÖÁ©∫'); }

        function toggleHistory() {
            document.getElementById('historyPanel').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('show');
        }

        // Utils
        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('emptyState').style.display = 'flex';
            document.getElementById('outputArea').style.display = 'none';
            document.getElementById('stats').style.display = 'none';
            document.getElementById('toolbar').style.display = 'none';
            parsedCookies = [];
        }

        function loadExample() {
            document.getElementById('input').value = `_device_id\t53a0425c0b0f99d4f9765e78ddbe7f94\tgithub.com\t/\t2027-01-31\t42\t‚úì\t‚úì\tLax
logged_in\tyes\t.github.com\t/\t2027-01-31\t12\t‚úì\t‚úì\tLax
user_session\tDqo5rQjCPvdBGp7SL7EOwI-tzlaS49lR\tgithub.com\t/\t2026-02-14\t60\t‚úì\t‚úì\tStrict
_gh_sess\ttZZhnVxzPs9W%2Bp8M1lnsGT81BEnHOE5Pg\tgithub.com\t/\tSession\t100\t‚úì\t‚úì\tLax
color_mode\t%7B%22color_mode%22%3A%22auto%22%7D\t.github.com\t/\tSession\t50\t\t‚úì\tLax`;
            toast('Â∑≤Âä†ËΩΩÁ§∫‰æã');
        }

        function toast(m) {
            const t = document.getElementById('toast');
            t.textContent = m;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        function tryDecode(s) { try { return decodeURIComponent(s); } catch { return s; } }
        function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
        function capitalize(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

        document.getElementById('urlDecode').addEventListener('change', () => { if (parsedCookies.length) render(); });
    </script>
</body>
</html>
